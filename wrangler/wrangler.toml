# -------------------------------------------------
# Base config (shared across environments)
# -------------------------------------------------

name = "planning-poker-backend"
main = "src/index.ts"
compatibility_date = "2025-12-31"

[dev]
ip = "0.0.0.0"
port = 8787

# -------------------------------------------------
# Migrations (shared, env-specific history)
# -------------------------------------------------

[[migrations]]
tag = "v1"
new_sqlite_classes = ["Game"]

[[migrations]]
tag = "v2"
new_sqlite_classes = ["GameRegistry"]

# -------------------------------------------------
# Development environment
# -------------------------------------------------

[vars]
ALLOWED_ORIGINS = "http://localhost:5173"

[[durable_objects.bindings]]
name = "GAME"
class_name = "Game"

[[durable_objects.bindings]]
name = "REGISTRY"
class_name = "GameRegistry"

# -------------------------------------------------
# Staging environment
# -------------------------------------------------

[env.staging]
name = "planning-poker-backend-staging"

[env.staging.vars]
ALLOWED_ORIGINS = "https://planning-poker-ba3.pages.dev,http://localhost:5173"

[[env.staging.durable_objects.bindings]]
name = "GAME"
class_name = "Game"

[[env.staging.durable_objects.bindings]]
name = "REGISTRY"
class_name = "GameRegistry"

# -------------------------------------------------
# Production environment
# -------------------------------------------------

[env.production]
name = "planning-poker-backend-production"

[env.production.vars]
ALLOWED_ORIGINS = "https://planning-poker-ba3.pages.dev"

[[env.production.durable_objects.bindings]]
name = "GAME"
class_name = "Game"

[[env.production.durable_objects.bindings]]
name = "REGISTRY"
class_name = "GameRegistry"
